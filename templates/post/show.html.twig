{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
<div class="post-detail-container">
    <div class="post-detail-wrapper">
        <!-- Imagen del post -->
        <div class="post-detail-image-section">
            {% if post.image %}
                <img src="{{ asset('img/' ~ post.image) }}" alt="{{ post.title }}" class="post-detail-image">
            {% else %}
                <div class="post-detail-image-placeholder">
                    <span>{{ post.title }}</span>
                </div>
            {% endif %}
        </div>
        
        <!-- Contenido y comentarios -->
        <div class="post-detail-content-section">
            <!-- Header del post -->
            <div class="post-detail-header">
                <div class="post-detail-author-info">
                    {% if post.author.picture %}
                        <img src="{{ asset('img/' ~ post.author.picture) }}" alt="{{ post.author.username }}" class="post-detail-avatar">
                    {% else %}
                        <div class="post-detail-avatar avatar-placeholder">{{ post.author.username|first|upper }}</div>
                    {% endif %}
                    <div class="post-detail-author-details">
                        <a href="{{ path('app_user_show', {'id': post.author.id}) }}" class="post-detail-author-name">{{ post.author.username }}</a>
                        <span class="post-detail-date">{{ post.createdAt ? post.createdAt|date('d/m/Y H:i') : '' }}</span>
                    </div>
                </div>
                {% if app.user and app.user.id == post.author.id %}
                    <div class="post-detail-actions-menu">
                        <a href="{{ path('app_post_edit', {'id': post.id}) }}" class="post-detail-action-btn" title="Editar">‚úèÔ∏è</a>
                        {{ include('post/_delete_form.html.twig') }}
                    </div>
                {% endif %}
            </div>
            
            <!-- T√≠tulo y contenido -->
            <div class="post-detail-body">
                <h1 class="post-detail-title">{{ post.title }}</h1>
                <div class="post-detail-content">{{ post.content }}</div>
            </div>
            
            <!-- Acciones (like, comentar) -->
            {% if app.user %}
            <div class="post-detail-actions">
                <div class="post-detail-actions-buttons">
                    {% if post in app.user.likes %}
                        <a href="{{ path('app_post_dislike', {'id': post.id}) }}" class="post-detail-action-icon liked">‚ù§Ô∏è</a>
                    {% else %}
                        <a href="{{ path('app_post_like', {'id': post.id}) }}" class="post-detail-action-icon">ü§ç</a>
                    {% endif %}
                </div>
                <div class="post-detail-likes-count">
                    <strong>{{ post.likes|length }}</strong> me gusta
                </div>
            </div>
            {% else %}
            <div class="post-detail-actions">
                <div class="post-detail-likes-count">
                    <strong>{{ post.likes|length }}</strong> me gusta
                </div>
            </div>
            {% endif %}
            
            <!-- Comentarios -->
            <div class="post-detail-comments">
                <div class="post-detail-comments-header">
                    <h3>Comentarios</h3>
                    {% if app.user %}
                        <a href="{{ path('app_comment_new', {'post': post.id}) }}" class="add-comment-btn">
                            <span>üí¨</span>
                            <span>A√±adir comentario</span>
                        </a>
                    {% endif %}
                </div>
                
                {% if post.comments|length > 0 %}
                    <div class="post-detail-comments-list">
                        {% for comment in post.comments %}
                            {% if comment.visible %}
                                <div class="post-detail-comment">
                                    <div class="post-detail-comment-avatar-wrapper">
                                        {% if comment.author.picture %}
                                            <img src="{{ asset('img/' ~ comment.author.picture) }}" alt="{{ comment.author.username }}" class="post-detail-comment-avatar">
                                        {% else %}
                                            <div class="post-detail-comment-avatar avatar-placeholder">{{ comment.author.username|first|upper }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="post-detail-comment-content-wrapper">
                                        <div class="post-detail-comment-header">
                                            <a href="{{ path('app_user_show', {'id': comment.author.id}) }}" class="post-detail-comment-author">{{ comment.author.username }}</a>
                                            <span class="post-detail-comment-date">{{ comment.createdAt ? comment.createdAt|date('d/m/Y H:i') : '' }}</span>
                                        </div>
                                        <div class="post-detail-comment-text">{{ comment.content }}</div>
                                    </div>
                                    {% if app.user and (app.user.id == comment.author.id or 'ROLE_ADMIN' in app.user.roles) %}
                                        <form method="post" action="{{ path('app_comment_delete', {'id': comment.id}) }}" class="post-detail-comment-delete">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                                            <button type="submit" class="comment-delete-icon" title="Eliminar">üóëÔ∏è</button>
                                        </form>
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="post-detail-no-comments">
                        <p>No hay comentarios todav√≠a. ¬°S√© el primero en comentar!</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Bot√≥n volver -->
            <div class="post-detail-footer">
                <a href="{{ path('app_post_index') }}" class="back-to-feed-btn">
                    <span>‚Üê</span>
                    <span>Volver al feed</span>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
