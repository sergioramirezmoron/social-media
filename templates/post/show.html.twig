{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
<div class="post-detail">
    <div class="post-header">
        {% if post.author.picture %}
            <img src="{{ asset('img/' ~ post.author.picture) }}" alt="{{ post.author.username }}" class="post-author-avatar">
        {% else %}
            <div class="post-author-avatar" style="background-color: #ddd; display: flex; align-items: center; justify-content: center; color: #999; font-weight: bold;">{{ post.author.username|first|upper }}</div>
        {% endif %}
        <a href="{{ path('app_user_show', {'id': post.author.id}) }}" class="post-author-name">{{ post.author.username }}</a>
        <span class="post-date">{{ post.createdAt ? post.createdAt|date('d/m/Y H:i') : '' }}</span>
    </div>
    
    {% if post.image %}
        <img src="{{ asset('img/' ~ post.image) }}" alt="{{ post.title }}">
    {% endif %}
    
    <h1>{{ post.title }}</h1>
    <div class="post-content">{{ post.content }}</div>
    
    <div class="post-actions">
        <a href="{{ path('app_post_index') }}" class="btn btn-secondary">Volver</a>
        {% if app.user and app.user.id == post.author.id %}
            <a href="{{ path('app_post_edit', {'id': post.id}) }}" class="btn btn-primary">Editar</a>
            {{ include('post/_delete_form.html.twig') }}
        {% endif %}
    </div>
    <h3>Comentarios</h3>

    {% if post.comments|length > 0 %}
        <ul>
            {% for comment in post.comments %}
                {% if comment.visible %}
                    <li>
                        <strong>{{ comment.author.username }}:</strong> {{ comment.content }}
                        <small>({{ comment.createdAt ? comment.createdAt|date('d/m/Y H:i') : '' }})</small>

                        {% if app.user and (app.user.id == comment.author.id or 'ROLE_ADMIN' in app.user.roles) %}
                            <form method="post" action="{{ path('app_comment_delete', {'id': comment.id}) }}" style="display:inline">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                                <button type="submit">Eliminar Comentario</button>
                            </form>
                        {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    {% else %}
        <p>No hay comentarios todav√≠a.</p>
    {% endif %}
</div>
{% endblock %}
